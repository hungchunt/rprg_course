---
title: '20170215'
author: "Hung-Chun T"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#<font color=#003377 face="標楷體">**使用 apply 函數家族**</font>

---

##<font face="標楷體">迴圈(較慢)</font>

```{r}
result <- rep(NA, times = 2) #建立兩個空的變數
for (i in 1:length(cars)) {
  result[i] <- mean(cars[, i])
}
result
```

##<font face="標楷體">apply() 產生結果為變數</font>

```{r}
apply(cars, FUN = mean, MARGIN = 2) #MARGIN= 2 column ;=1 row
```

---

##<font face="標楷體">lapply() 產生結果為list</font>

```{r}
my_list <- list(1:10, 1:100)
lapply(my_list, FUN = mean)
unlist(lapply(my_list, FUN = mean)) # 解開成為變數
lapply(mtcars, FUN = mean)
unlist(lapply(mtcars, FUN = mean))
```

---

##<font face="標楷體">sapply() 產生結果為變數, 不須指定MARGIN</font>

```{r}
my_list <- list(1:10, 1:100)
sapply(my_list, FUN = mean)
sapply(mtcars, FUN = mean)
```

---

##<font face="標楷體">tapply() 樞紐分析</font>

```{r}
head(iris)
tapply(iris$Sepal.Length, INDEX = iris$Species, FUN = mean)
#以不同品種分析Septal.Length的平均值
```

---

##<font face="標楷體">使用 system.time() 檢視執行所需時間(我覺得沒用)</font>

```{r}
# 建立 data frame
col1 <- runif (12^4, min = 0, max = 2)
col2 <- rnorm (12^4, mean = 0, sd = 2)
col3 <- rpois (12^4, lambda = 3)
col4 <- rchisq (12^4, df = 2)
df <- data.frame (col1, col2, col3, col4)

# 使用 apply() 計算每列的總和
system.time(apply(df, FUN = sum, MARGIN = 1))
```

---

##<font face="標楷體">為何要自訂函數</font>

> - <font face="標楷體"> R 語言本質上是一個函數型語言。</font>
 - <font face="標楷體"> 一如我們在第二章就引用的名言佳句：Everything that happens is a function call By John Chambers</font>
 
> - Section 1: library packages
 - Section 2: Self-defined functions
 - Section 3: Inputs and parameters
 - Section 4: Function calls

###<font face="標楷體">。建立一個 circle.calculate() 函數</font>
```{r}
# Section 1: library packages

# Section 2: self-defined functions
#function()建立函數, 定義input,且定義is_area預設值為TRUE
circle.calculator <- function(r, is_area = TRUE) {
	area <- pi * r^2
  circum <- 2 * pi * r
  if (is_area == TRUE) {
  	return(area)
  } else {
  	return(circum)
  }
}

# Section 3: inputs and parameters
my_radius <- 5
is_area <- TRUE

# Section 4: function calls
circle_area <- circle.calculator(my_radius)
circle_circum <- circle.calculator(my_radius, is_area = FALSE)
circle_area
circle_circum
```

###<font face="標楷體">。建立一個length() 函數</font>

```{r}
# Section 1: library packages

# Section 2: self-defined functions
my.length <- function(input_vector) {
	count <- 0 #初始化計數器,每次跑function都會從0開始
  for (i in input_vector) {
  	count <- count + 1 #每走過一次函數,count會加一
  }
  return(count) #呈現output
}

# Section 3: inputs and parameters
my_vector <- 1:10
another_vector <- 1:100

# Section 4: function call
my.length(my_vector)
my.length(another_vector)
```

###<font face="標楷體">。建立一個sum()函數</font>

```{r}
# Section 1: library packages

# Section 2: self-defined functions
my.sum <- function(input_vector) {
	summation <- 0
  for (i in input_vector) {
  	summation <- summation + i
  }
  return(summation)
}

# Section 3: inputs and parameters
my_vector <- 1:10
another_vector <- 1:100

# Section 4: function call
my.sum(my_vector)
my.sum(another_vector)
```

###<font face="標楷體">。建立一個mean()函數</font>

```{r}
# Section 1: library packages

# Section 2: self-defined functions
my.mean <- function(input_vector) {
	summation <- 0
  count <- 0
  for (i in input_vector) {
  	summation <- summation + i
    count <- count + 1
  }
  return (summation / count)
}

# Section 3: inputs and parameters
my_vector <- 1:10
another_vector <- 1:100

# Section 4: function call
my.mean(my_vector)
my.mean(another_vector)
```

###<font face="標楷體">。建立一個sort()函數(Ascending Exchange Sort)</font>

> <font face="標楷體">建立一具有遞增排序功能之函數。  
從第一個變數開始跟後面全部變數依序比大小,一旦出現前值大於後值之情況, 就將兩個變數互換位置。</font>

> c(3, 1, 2)  
"Round1-1":3 > 1 -> exchange, c(1, 3, 2) 比較第一個跟第二個  
"Round1-2":1 > 2 -> remain, c(1, 3, 2) 比較第一個跟第三個  
"Round2-1":3 > 2 -> exchange, c(1, 2, 3) 比較第二個跟第三個

```{r}
# Section 1: library packages

# Section 2: self-defined functions
my.sort <- function(input_vector) {
	for (i in 1:(length(input_vector) - 1)) {
  	for (j in (i + 1):length(input_vector)) {
    	temp <- input_vector[i]
      if (input_vector[i] > input_vector[j]) {
      	input_vector[i] <- input_vector[j]
        input_vector[j] <- temp
      }
    }
  }
  return(input_vector)
}

# Section 3: inputs and parameters
set.seed(87)
rand_vector <- ceiling(runif(10) * 100)
rand_vector

# Section 4: function call
my.sort(rand_vector)
```
